<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Maharashtra eBird Dashboard</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
}

header {
  background:#1b5e20;
  color:white;
  padding:15px;
  text-align:center;
}

.controls {
  padding:15px;
  background:#f5f5f5;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  align-items:center;
}

select, button {
  padding:6px 10px;
  font-size:14px;
}

button.green {
  background:#2e7d32;
  color:white;
  border:none;
}

button.gray {
  background:#9e9e9e;
  color:white;
  border:none;
}

button.active {
  outline:3px solid #1b5e20;
}

iframe {
  width:100%;
  height:85vh;
  border:none;
}
</style>
</head>
<body>

<header>
  <h2>Maharashtra eBird Explorer</h2>
</header>

<div class="controls">

<button class="green active" id="btnMonthly" onclick="setMode('monthly')">Monthly</button>
<button class="green" id="btnSeasonal" onclick="setMode('seasonal_new')">Seasonal</button>
<button class="gray" id="btnOld" onclick="setMode('seasonal_old')">Old (Season)</button>

<select id="year">
  <option>2025</option>
  <option>2026</option>
</select>

<select id="month">
  <option>January</option>
  <option>February</option>
  <option>March</option>
  <option>April</option>
  <option>May</option>
  <option>June</option>
  <option>July</option>
  <option>August</option>
  <option>September</option>
  <option>October</option>
  <option>November</option>
  <option>December</option>
</select>

<select id="season" disabled>
  <option>Winter</option>
  <option>Summer</option>
  <option>Monsoon</option>
</select>

<button onclick="loadMap()">Load</button>

</div>

<iframe id="mapFrame"></iframe>

<script>

let currentMode = "monthly";

function setMode(mode) {
  currentMode = mode;

  document.getElementById("btnMonthly").classList.remove("active");
  document.getElementById("btnSeasonal").classList.remove("active");
  document.getElementById("btnOld").classList.remove("active");

  if (mode === "monthly") {
    document.getElementById("btnMonthly").classList.add("active");
    document.getElementById("month").disabled = false;
    document.getElementById("season").disabled = true;
  }

  if (mode === "seasonal_new") {
    document.getElementById("btnSeasonal").classList.add("active");
    document.getElementById("month").disabled = true;
    document.getElementById("season").disabled = false;
  }

  if (mode === "seasonal_old") {
    document.getElementById("btnOld").classList.add("active");
    document.getElementById("month").disabled = true;
    document.getElementById("season").disabled = false;
  }

  updateAvailability();
}


function loadMap() {

  let year = document.getElementById("year").value;
  let month = document.getElementById("month").value;
  let season = document.getElementById("season").value;

  let mapPath = "";

  if (currentMode === "monthly") {
    mapPath = "months/" + month + "_" + year + ".html";
  }

  if (currentMode === "seasonal_new") {
    mapPath = "new seasons/" + season + " " + year + ".html";
  }

  if (currentMode === "seasonal_old") {
    mapPath = "seasons/" + season + " " + year + ".html";
  }

  document.getElementById("mapFrame").src = mapPath;
}


function fileExists(url, callback) {
  fetch(url, { method: "HEAD" })
    .then(response => callback(response.ok))
    .catch(() => callback(false));
}


function updateAvailability() {

  let yearSelect = document.getElementById("year");
  let monthSelect = document.getElementById("month");
  let seasonSelect = document.getElementById("season");

  let selectedYear = yearSelect.value;

  if (currentMode === "monthly") {

    Array.from(monthSelect.options).forEach(option => {

      let path = "months/" + option.value + "_" + selectedYear + ".html";

      fileExists(path, function(exists) {
        option.disabled = !exists;
      });

    });

  } else {

    Array.from(seasonSelect.options).forEach(option => {

      let baseFolder = currentMode === "seasonal_new"
        ? "new seasons/"
        : "seasons/";

      let path = baseFolder + option.value + " " + selectedYear + ".html";

      fileExists(path, function(exists) {
        option.disabled = !exists;
      });

    });
  }
}


// Update when year changes
document.getElementById("year").addEventListener("change", updateAvailability);

// Initial load
updateAvailability();

</script>

</body>
</html>
